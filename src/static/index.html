<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feed Fusion — агрегатор новостей</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Golos+Text:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="ambient">
      <span class="orb orb-1"></span>
      <span class="orb orb-2"></span>
      <span class="orb orb-3"></span>
      <span class="grid"></span>
    </div>

    <header class="site-header">
      <a class="logo" href="#/news">
        <span>Feed</span>
        <span>Fusion</span>
      </a>
      <nav class="nav">
        <a class="nav-link" href="#/news">Новости</a>
        <a class="nav-link" href="#/channels">Каналы</a>
        <a class="nav-link auth-only" href="#/subscriptions">Подписки</a>
        <a class="nav-link auth-only" href="#/profile">Профиль</a>
        <a class="nav-link admin-only" href="#/admin-channels">Упр. каналами</a>
        <a class="nav-link admin-only" href="#/admin-samples">Импорт данных</a>
        <a class="nav-link admin-only" href="#/admin-training">Обучение ML</a>
      </nav>
      <div class="header-actions">
        <button class="btn ghost" id="loginBtn">Войти</button>
        <button class="btn accent" id="registerBtn">Регистрация</button>
        <button class="btn ghost" id="logoutBtn" hidden>Выйти</button>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <div class="hero-text">
          <p class="eyebrow">Агрегатор новостей</p>
          <h1>Собирайте актуальную ленту из любимых источников.</h1>
          <p class="subhead">
            Feed Fusion объединяет RSS-каналы, помогает находить важное и
            доставляет новости в Telegram для авторизованных пользователей.
          </p>
          <div class="hero-actions">
            <button class="btn accent" id="heroRefresh">Обновить ленту</button>
            <button class="btn ghost" id="heroExplore">Исследовать каналы</button>
          </div>
        </div>
        <div class="hero-card">
          <div>
            <h3>Сейчас в фокусе</h3>
            <p class="muted">Умная фильтрация, поиск, сортировка и подписки.</p>
          </div>
          <div class="hero-metrics">
            <div>
              <span class="metric" id="newsTotal">0</span>
              <span class="label">новостей</span>
            </div>
            <div>
              <span class="metric" id="channelTotal">0</span>
              <span class="label">каналов</span>
            </div>
            <div>
              <span class="metric" id="userState">Гость</span>
              <span class="label">статус</span>
            </div>
          </div>
        </div>
      </section>

      <section id="news" class="view" data-view>
        <div class="section-head">
          <div>
            <h2>Новости</h2>
            <p class="muted" id="newsMeta">Гибкая фильтрация по запросу и каналам.</p>
          </div>
        </div>

        <div class="chips chips-below">
          <span class="chip" id="activeFilter">Все каналы</span>
          <span class="chip" id="activeCategories">Все категории</span>
          <span class="chip" id="activeSort">Сначала новые</span>
        </div>

        <div class="filters">
          <div class="filters-top">
            <label class="field">
              <span>Поиск</span>
              <input type="search" id="searchInput" placeholder="Ключевые слова" />
            </label>
            <button class="btn accent filters-apply" id="applyFilters">
              Найти
            </button>
          </div>
          <div class="filters-bottom">
            <label class="field">
              <span>Канал</span>
              <div class="channel-select" id="channelSelect">
                <button class="channel-toggle" id="channelToggle" type="button">
                  Все каналы
                </button>
                <div class="channel-dropdown" id="channelDropdown" hidden></div>
              </div>
            </label>
            <label class="field">
              <span>Сортировка</span>
              <select id="sortSelect">
                <option value="true" selected>Сначала новые</option>
                <option value="false">Сначала старые</option>
              </select>
            </label>
            <label class="field">
              <span>Категории</span>
              <div class="channel-select" id="categorySelect">
                <button class="channel-toggle" id="categoryToggle" type="button">
                  Все категории
                </button>
                <div class="channel-dropdown" id="categoryDropdown" hidden></div>
              </div>
            </label>
            <div class="filter-actions">
              <button class="btn ghost" id="resetFilters">Сбросить</button>
            </div>
          </div>
        </div>

        <div id="newsGrid" class="card-grid"></div>

        <div class="news-sentinel" id="newsSentinel" aria-hidden="true"></div>
      </section>

      <section id="channels" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Каналы</h2>
            <p class="muted">Подпишитесь, чтобы получать новости в Telegram.</p>
          </div>
          <div class="chips">
            <span class="chip" id="channelMeta">0 каналов</span>
          </div>
        </div>
        <div id="channelGrid" class="card-grid"></div>
      </section>

      <section id="subscriptions" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Мои подписки</h2>
            <p class="muted">Управляйте подключенными источниками.</p>
          </div>
        </div>
        <div id="subsGrid" class="card-grid"></div>
      </section>

      <section id="profile" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Профиль</h2>
            <p class="muted">Укажите Telegram ID для получения новостей.</p>
          </div>
        </div>
        <div class="profile-layout">
          <div class="panel profile-card">
            <h3>Основная информация</h3>
            <div class="profile-info" id="profileInfo"></div>
          </div>
          <form class="panel profile-card" id="profileForm">
            <h3>Редактировать</h3>
            <label class="field">
              <span>Имя</span>
              <input type="text" name="first_name" />
            </label>
            <label class="field">
              <span>Фамилия</span>
              <input type="text" name="last_name" />
            </label>
            <label class="field">
              <span>Telegram ID</span>
              <input type="text" name="telegram_id" placeholder="Например: 123456789" />
            </label>
            <button class="btn accent" type="submit">Сохранить</button>
          </form>
        </div>
      </section>

      <section id="admin-channels" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Управление каналами</h2>
            <p class="muted">Добавление, редактирование и удаление RSS-источников.</p>
          </div>
        </div>
        <div class="admin-layout">
          <form class="panel form-card" id="channelCreateForm">
            <h3>Добавить канал</h3>
            <label class="field">
              <span>Название</span>
              <input type="text" name="title" required />
            </label>
            <label class="field">
              <span>RSS-ссылка</span>
              <input type="url" name="link" required placeholder="https://example.com/rss" />
            </label>
            <label class="field">
              <span>Описание</span>
              <textarea name="description" rows="3"></textarea>
            </label>
            <button class="btn accent" type="submit">Добавить</button>
          </form>
          <div class="panel admin-list">
            <h3>Список каналов</h3>
            <div id="adminChannelList" class="stack"></div>
          </div>
        </div>
      </section>

      <section id="admin-samples" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Импорт и разметка данных</h2>
            <p class="muted">Загрузка CSV и ручное пополнение обучающей выборки.</p>
          </div>
        </div>
        <div class="admin-layout admin-ml-layout">
          <form class="panel form-card" id="sampleUploadForm">
            <h3>Импорт данных для обучения</h3>
            <p class="muted">
              Загрузите CSV с полями: <code>title</code>, <code>summary</code>, <code>category</code>.
            </p>
            <label class="field">
              <span>CSV-файл</span>
              <input type="file" id="sampleCsvFile" name="file" accept=".csv,text/csv" required />
            </label>
            <button class="btn accent" type="submit">Загрузить датасет</button>
            <button class="btn ghost" type="button" id="refreshUploadsBtn">
              Обновить статусы импортов
            </button>
            <div id="uploadsList" class="stack compact-stack"></div>
          </form>

          <form class="panel form-card" id="sampleLabelForm">
            <h3>Добавить размеченный пример</h3>
            <p class="muted">
              Укажите ID новости и нужную категорию для пополнения обучающей выборки.
            </p>
            <label class="field">
              <span>ID новости</span>
              <input type="number" id="sampleNewsId" min="1" required />
            </label>
            <label class="field">
              <span>Категория</span>
              <select id="sampleCategorySelect" required></select>
            </label>
            <button class="btn accent" type="submit">Добавить в выборку</button>
          </form>
        </div>
      </section>

      <section id="admin-training" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Обучение ML модели</h2>
            <p class="muted">Ручной запуск обучения и мониторинг метрик.</p>
          </div>
        </div>
        <div class="admin-layout admin-ml-layout">
          <div class="panel form-card">
            <h3>Параметры обучения</h3>
            <form id="trainModelForm" class="inline-form">
              <div class="two-col-grid">
                <label class="field">
                  <span>epochs</span>
                  <input type="number" name="epochs" min="1" value="10" />
                </label>
                <label class="field">
                  <span>batch_size</span>
                  <input type="number" name="batch_size" min="1" value="64" />
                </label>
                <label class="field">
                  <span>lr</span>
                  <input type="number" name="lr" step="0.0001" min="0" value="0.001" />
                </label>
                <label class="field">
                  <span>val_split</span>
                  <input type="number" name="val_split" step="0.01" min="0" max="0.9" value="0.1" />
                </label>
                <label class="field">
                  <span>embed_dim</span>
                  <input type="number" name="embed_dim" min="8" value="128" />
                </label>
                <label class="field">
                  <span>dropout</span>
                  <input type="number" name="dropout" step="0.01" min="0" max="1" value="0.2" />
                </label>
              </div>
              <label class="field checkbox-field">
                <input type="checkbox" name="balance" />
                <span>Балансировать классы</span>
              </label>
              <div class="actions">
                <button class="btn accent" type="submit">Запустить обучение</button>
                <button class="btn ghost" type="button" id="refreshTrainingsBtn">
                  Обновить статусы обучений
                </button>
              </div>
            </form>
          </div>

          <div class="panel form-card">
            <h3>История обучений</h3>
            <div id="trainingsList" class="stack compact-stack"></div>
          </div>

          <div class="panel form-card">
            <h3>График прогресса</h3>
            <canvas id="trainingChart" width="640" height="260" aria-label="График обучения модели"></canvas>
            <p class="muted" id="trainingChartInfo">Выберите обучение для отображения метрик.</p>
          </div>
        </div>
      </section>

      <section id="auth" class="view" data-view hidden>
        <div class="section-head">
          <div>
            <h2>Авторизация</h2>
            <p class="muted">Создайте аккаунт или войдите в существующий.</p>
          </div>
        </div>
        <div class="auth-layout">
          <form class="panel form-card" id="loginForm">
            <h3>Войти</h3>
            <label class="field">
              <span>Логин</span>
              <input type="text" name="username" required />
            </label>
            <label class="field">
              <span>Пароль</span>
              <input type="password" name="password" required />
            </label>
            <button class="btn accent" type="submit">Войти</button>
          </form>
          <form class="panel form-card" id="registerForm">
            <h3>Регистрация</h3>
            <label class="field">
              <span>Логин</span>
              <input type="text" name="username" required />
            </label>
            <label class="field">
              <span>Пароль</span>
              <input type="password" name="password" required />
            </label>
            <button class="btn ghost" type="submit">Создать аккаунт</button>
          </form>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <p>Feed Fusion — минималистичная витрина новостей и подписок.</p>
    </footer>

    <div class="toast" id="toast" hidden></div>

    <script type="module" src="/static/app.js"></script>
  </body>
</html>
